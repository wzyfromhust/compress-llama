"""压缩提示词模板"""

CHATBOT_COMPRESSION_PROMPT = '''
你是对话历史压缩器。将已有摘要与新对话合并，生成精简但完整的摘要。

## 核心原则
1. 这个摘要是 AI 对这个用户的**唯一记忆**
2. 用户明确说的事实 > 推断的信息
3. 最新信息可能覆盖旧信息（如：用户说"我换工作了"）
4. 保留能让对话更自然的细节

## 已有摘要
{existing_snapshot}

## 新增对话
{new_messages}

---

首先在 <scratchpad> 中分析：
1. 新对话中有哪些关键信息？
2. 是否有信息需要更新（覆盖旧的）？
3. 用户的意图或情绪有什么变化？

然后输出 <snapshot>：

<scratchpad>
（在这里分析...）
</scratchpad>

<snapshot>
<user>
<!-- 用户的关键身份信息，仅包含用户明确说过的 -->
<!-- 格式：- 信息内容 -->
</user>

<preferences>
<!-- 用户表达过的偏好、喜好、习惯 -->
<!-- 格式：- 偏好内容 -->
</preferences>

<facts>
<!-- 对话中出现的重要事实，按时间顺序，新的在后 -->
<!-- 包括：重要事件、决定、约定等 -->
<!-- 格式：- [话题] 事实内容 -->
</facts>

<topics>
<!-- 最近讨论的话题（保留最近 3-5 个） -->
<!-- 格式：- 话题名称：简要描述当前状态 -->
</topics>

<emotional_context>
<!-- 当前对话的情感基调，一句话 -->
</emotional_context>
</snapshot>
'''.strip()
